<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>类型检测 | Atomic Kotlin</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/Atomic-Kotlin-zh/favicon.png">
    <meta name="description" content="《Atomic Kotlin》中文版">
    
    <link rel="preload" href="/Atomic-Kotlin-zh/assets/css/0.styles.0481417b.css" as="style"><link rel="preload" href="/Atomic-Kotlin-zh/assets/js/app.6fe342f5.js" as="script"><link rel="preload" href="/Atomic-Kotlin-zh/assets/js/2.3bbd8e5a.js" as="script"><link rel="preload" href="/Atomic-Kotlin-zh/assets/js/184.51f2111c.js" as="script"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/10.8027425e.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/100.7bf10395.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/101.2e3afe4f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/102.976e57dc.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/103.cfa580a2.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/104.74c9f1a1.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/105.14d5155c.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/106.064ec666.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/107.825d82ca.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/108.d1b365e5.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/109.6b7f42ee.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/11.4c965fe7.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/110.970054be.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/111.5b7670cc.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/112.77d6525a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/113.1ac7dea0.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/114.8a4418f3.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/115.052dda4b.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/116.dae7014e.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/117.fde5e70f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/118.97c4e40d.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/119.c2ec64ef.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/12.0a62c95a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/120.6ea76984.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/121.909ab69a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/122.bfeb7353.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/123.b21568e1.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/124.f334bb5a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/125.e5d4523a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/126.1df8d99f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/127.8a70898f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/128.686d94e6.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/129.0db1554c.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/13.d72b0805.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/130.c70996de.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/131.aad49292.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/132.7b412582.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/133.59c4ab43.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/134.6aea3044.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/135.d813b243.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/136.6a0cac62.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/137.f4ed4df2.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/138.428696b6.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/139.10f53b00.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/14.13072547.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/140.7e06c599.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/141.b3734e6e.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/142.118c2314.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/143.81d376c1.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/144.9d27b67a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/145.b57d113c.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/146.b565e7ab.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/147.02f077c5.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/148.a749f225.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/149.0b437aac.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/15.55cddf86.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/150.c3663d54.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/151.a0f6e0cd.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/152.3aef563c.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/153.d3a27cae.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/154.f0e4df90.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/155.bd95d17f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/156.3be5c1cf.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/157.9495dd81.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/158.63dd9d6f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/159.9d94dd19.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/16.75a11323.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/160.3d6f2caf.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/161.70a26e9e.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/162.e8a8e5ea.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/163.1e55c561.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/164.533371e1.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/165.479d6f78.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/166.67642f6c.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/167.ae67ae2a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/168.cee4684f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/169.74b43084.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/17.fd398b47.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/170.0bebad77.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/171.4f998be8.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/172.5eb78875.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/173.aa7a1f82.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/174.c4d1b0ac.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/175.9e3641ff.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/176.d84fb5cf.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/177.44681a47.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/178.c8439c24.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/179.8ac50e3e.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/18.71dccdc5.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/180.b49d6deb.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/181.e9d86d5f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/182.de46be5f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/183.56cb97da.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/185.85cd96e8.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/186.4e40dc06.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/187.4a4a3f33.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/188.0b7823e3.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/189.6dabbba3.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/19.b99a5fa8.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/190.7401b58a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/191.21d7cda0.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/192.242b9bb5.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/193.85a7d2f7.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/194.04a720cb.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/195.0fa0d0df.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/196.29332622.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/197.7aee718a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/198.fc1b4348.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/199.9544c796.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/20.d92ea8f1.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/200.3ad1ab0e.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/201.b4bd5dbc.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/202.337475c6.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/203.1cda638f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/204.ab9123d9.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/205.5d292c2e.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/206.f2638b02.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/21.2572db79.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/22.df0283f6.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/23.e0501197.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/24.52ccb9cb.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/25.7a19aa89.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/26.431ef93f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/27.5a353bac.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/28.273ac0ba.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/29.b41126b7.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/3.6a4abdb0.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/30.4060375d.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/31.d9ce516f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/32.efdc5e5a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/33.6e607005.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/34.a5a04689.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/35.2d467980.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/36.6737d5b3.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/37.a2237475.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/38.ea14660c.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/39.471e8108.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/4.01e13298.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/40.a3039272.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/41.d054b37b.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/42.4715a631.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/43.1e9640ca.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/44.1e60e442.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/45.d1164886.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/46.8b2bdf07.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/47.cabde69f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/48.5eee1d63.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/49.9a9389e0.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/5.bb0e10da.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/50.905324ae.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/51.9ff564e6.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/52.12bcb01a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/53.d3bde2f6.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/54.23fae017.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/55.a56a46ab.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/56.e583a70a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/57.4124dcc4.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/58.6d2b2bfa.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/59.1792c913.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/6.a75c20a7.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/60.e79bca4b.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/61.733bcd5e.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/62.baf6946b.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/63.ac7d1958.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/64.c1d6e516.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/65.95c24f4a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/66.5e4db27a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/67.cb754fb0.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/68.e870a39c.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/69.5bdf3997.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/7.069c08dd.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/70.dea2e882.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/71.1975eca2.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/72.28b65046.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/73.dfedf158.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/74.a2a589aa.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/75.bb3b4f61.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/76.df48310b.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/77.1b8b85be.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/78.24e5dbb7.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/79.a7472bed.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/8.908dd7cc.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/80.fab7abe9.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/81.bcea6947.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/82.80f33ad7.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/83.4287302e.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/84.292e9609.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/85.de67d806.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/86.0bf524bc.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/87.1b97da02.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/88.95d3dedb.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/89.5519eb48.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/9.35ba2f97.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/90.ef33ca3b.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/91.4ab661dd.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/92.24380e01.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/93.ab217e4a.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/94.047a1915.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/95.876cf73f.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/96.c2558e1b.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/97.76a87672.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/98.ccda1cb8.js"><link rel="prefetch" href="/Atomic-Kotlin-zh/assets/js/99.0a0607b6.js">
    <link rel="stylesheet" href="/Atomic-Kotlin-zh/assets/css/0.styles.0481417b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Atomic-Kotlin-zh/" class="home-link router-link-active"><img src="/Atomic-Kotlin-zh/favicon.png" alt="Atomic Kotlin" class="logo"> <span class="site-name can-hide">Atomic Kotlin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Atomic-Kotlin-zh/toc.html" class="nav-link">
  目录
</a></div><div class="nav-item"><a href="https://www.atomickotlin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Atomic-Kotlin-zh/se05-ch14.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/Atomic-Kotlin-zh/en/se05-ch14.html" class="nav-link">
  English
</a></li></ul></div></div> <a href="https://github.com/Angus-Liu/Atomic-Kotlin-zh" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Atomic-Kotlin-zh/toc.html" class="nav-link">
  目录
</a></div><div class="nav-item"><a href="https://www.atomickotlin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Atomic-Kotlin-zh/se05-ch14.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/Atomic-Kotlin-zh/en/se05-ch14.html" class="nav-link">
  English
</a></li></ul></div></div> <a href="https://github.com/Angus-Liu/Atomic-Kotlin-zh" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/Atomic-Kotlin-zh/copyright.html" class="sidebar-link">版权声明</a></li><li><section class="sidebar-group depth-0"><a href="/Atomic-Kotlin-zh/se01" class="sidebar-heading clickable"><span>第一章 编程基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Atomic-Kotlin-zh/se01-ch01.html" class="sidebar-link">介绍</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch02.html" class="sidebar-link">Why Kotlin?</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch03.html" class="sidebar-link">Hello, World!</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch04.html" class="sidebar-link">var &amp; val</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch05.html" class="sidebar-link">Data Types</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch06.html" class="sidebar-link">Functions</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch07.html" class="sidebar-link">if Expressions</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch08.html" class="sidebar-link">String Templates</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch09.html" class="sidebar-link">Number Types</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch10.html" class="sidebar-link">Booleans</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch11.html" class="sidebar-link">Repetition with while</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch12.html" class="sidebar-link">Looping &amp; Ranges</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch13.html" class="sidebar-link">The in Keyword</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch14.html" class="sidebar-link">Expressions &amp; Statements</a></li><li><a href="/Atomic-Kotlin-zh/se01-ch15.html" class="sidebar-link">Summary 1</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Atomic-Kotlin-zh/se02" class="sidebar-heading clickable"><span>Section II</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Atomic-Kotlin-zh/se02-ch01.html" class="sidebar-link">Objects Everywhere</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch02.html" class="sidebar-link">Creating Classes</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch03.html" class="sidebar-link">Properties</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch04.html" class="sidebar-link">Constructors</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch05.html" class="sidebar-link">Constraining Visibility</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch06.html" class="sidebar-link">Packages</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch07.html" class="sidebar-link">Testing</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch08.html" class="sidebar-link">Exceptions</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch09.html" class="sidebar-link">Lists</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch10.html" class="sidebar-link">Variable Argument Lists</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch11.html" class="sidebar-link">Sets</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch12.html" class="sidebar-link">Maps</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch13.html" class="sidebar-link">Property Accessors</a></li><li><a href="/Atomic-Kotlin-zh/se02-ch14.html" class="sidebar-link">Summary 2</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Atomic-Kotlin-zh/se03" class="sidebar-heading clickable"><span>Section III</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Atomic-Kotlin-zh/se03-ch01.html" class="sidebar-link">Extension Functions</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch02.html" class="sidebar-link">Named &amp; Default Arguments</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch03.html" class="sidebar-link">Overloading</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch04.html" class="sidebar-link">when Expressions</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch05.html" class="sidebar-link">Enumerations</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch06.html" class="sidebar-link">Data Classes</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch07.html" class="sidebar-link">Destructuring Declarations</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch08.html" class="sidebar-link">Nullable Types</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch09.html" class="sidebar-link">Safe Calls &amp; the Elvis Operator</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch10.html" class="sidebar-link">Non-Null Assertions</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch11.html" class="sidebar-link">Extensions for Nullable Types</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch12.html" class="sidebar-link">Introduction to Generics</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch13.html" class="sidebar-link">Extension Properties</a></li><li><a href="/Atomic-Kotlin-zh/se03-ch14.html" class="sidebar-link">break &amp; continue</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Atomic-Kotlin-zh/se04" class="sidebar-heading clickable"><span>Section IV</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Atomic-Kotlin-zh/se04-ch01.html" class="sidebar-link">Lambdas</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch02.html" class="sidebar-link">The Importance of Lambdas</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch03.html" class="sidebar-link">Operations on Collections</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch04.html" class="sidebar-link">Member References</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch05.html" class="sidebar-link">Higher-Order Functions</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch06.html" class="sidebar-link">Manipulating Lists</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch07.html" class="sidebar-link">Building Maps</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch08.html" class="sidebar-link">Sequences</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch09.html" class="sidebar-link">Local Functions</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch10.html" class="sidebar-link">Folding Lists</a></li><li><a href="/Atomic-Kotlin-zh/se04-ch11.html" class="sidebar-link">Recursion</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Atomic-Kotlin-zh/se05" class="sidebar-heading clickable open"><span>Section V</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Atomic-Kotlin-zh/se05-ch01.html" class="sidebar-link">Interfaces</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch02.html" class="sidebar-link">Complex Constructors</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch03.html" class="sidebar-link">Secondary Constructors</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch04.html" class="sidebar-link">Inheritance</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch05.html" class="sidebar-link">Base Class Initialization</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch06.html" class="sidebar-link">Abstract Classes</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch07.html" class="sidebar-link">Upcasting</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch08.html" class="sidebar-link">Polymorphism</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch09.html" class="sidebar-link">Composition</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch10.html" class="sidebar-link">Inheritance &amp; Extensions</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch11.html" class="sidebar-link">Class Delegation</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch12.html" class="sidebar-link">Downcasting</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch13.html" class="sidebar-link">Sealed Classes</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch14.html" aria-current="page" class="active sidebar-link">类型检测</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Atomic-Kotlin-zh/se05-ch15.html" class="sidebar-link">Nested Classes</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch16.html" class="sidebar-link">Objects</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch17.html" class="sidebar-link">Inner Classes</a></li><li><a href="/Atomic-Kotlin-zh/se05-ch18.html" class="sidebar-link">Companion Objects</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Atomic-Kotlin-zh/se06" class="sidebar-heading clickable"><span>Section VI</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Atomic-Kotlin-zh/se06-ch01.html" class="sidebar-link">Exception Handling</a></li><li><a href="/Atomic-Kotlin-zh/se06-ch02.html" class="sidebar-link">Check Instructions</a></li><li><a href="/Atomic-Kotlin-zh/se06-ch03.html" class="sidebar-link">The Nothing Type</a></li><li><a href="/Atomic-Kotlin-zh/se06-ch04.html" class="sidebar-link">Resource Cleanup</a></li><li><a href="/Atomic-Kotlin-zh/se06-ch05.html" class="sidebar-link">Logging</a></li><li><a href="/Atomic-Kotlin-zh/se06-ch06.html" class="sidebar-link">Unit Testing</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Atomic-Kotlin-zh/se07" class="sidebar-heading clickable"><span>Section VII</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Atomic-Kotlin-zh/se07-ch01.html" class="sidebar-link">Extension Lambdas</a></li><li><a href="/Atomic-Kotlin-zh/se07-ch02.html" class="sidebar-link">Scope Functions</a></li><li><a href="/Atomic-Kotlin-zh/se07-ch03.html" class="sidebar-link">Creating Generics</a></li><li><a href="/Atomic-Kotlin-zh/se07-ch04.html" class="sidebar-link">Operator Overloading</a></li><li><a href="/Atomic-Kotlin-zh/se07-ch05.html" class="sidebar-link">Using Operators</a></li><li><a href="/Atomic-Kotlin-zh/se07-ch06.html" class="sidebar-link">Property Delegation</a></li><li><a href="/Atomic-Kotlin-zh/se07-ch07.html" class="sidebar-link">Property Delegation Tools</a></li><li><a href="/Atomic-Kotlin-zh/se07-ch08.html" class="sidebar-link">Lazy Initialization</a></li><li><a href="/Atomic-Kotlin-zh/se07-ch09.html" class="sidebar-link">Late Initialization</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Atomic-Kotlin-zh/appendices" class="sidebar-heading clickable"><span>Appendices</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Atomic-Kotlin-zh/appendix-a.html" class="sidebar-link">附录 A：AtomicTest</a></li><li><a href="/Atomic-Kotlin-zh/appendix-b.html" class="sidebar-link">附录 B：Java 互操作性</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="类型检测"><a href="#类型检测" class="header-anchor">#</a> 类型检测</h1> <blockquote><p>在Kotlin中，您可以轻松地根据对象的类型对其进行操作. 通常，这是是多态性涉及的领域，因此<code>类型检查</code>可以实现有趣的设计选择.</p></blockquote> <p>一般来说,类型检查被用于一些特殊的例子中. 比如,大多数昆虫都可以飞,但是有一小部分昆虫是不能飞的.这种时候就没有必要因为一小部分昆虫不能飞,而让<code>Insect</code>接口变得更加&quot;沉重&quot;,所以在类型检查中,我们直接将这些特殊的昆虫类型挑出来.</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// TypeChecking/Insects.kt</span>
<span class="token keyword">package</span> typechecking
<span class="token keyword">import</span> atomictest<span class="token punctuation">.</span>eq

<span class="token keyword">interface</span> Insect <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token function">walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;<span class="token interpolation variable">$name</span>: walk&quot;</span>
  <span class="token keyword">fun</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;<span class="token interpolation variable">$name</span>: fly&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> HouseFly <span class="token operator">:</span> Insect

<span class="token keyword">class</span> Flea <span class="token operator">:</span> Insect <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">throw</span> <span class="token function">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;Flea cannot fly&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">fun</span> <span class="token function">crawl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Flea: crawl&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> Insect<span class="token punctuation">.</span><span class="token function">basic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
  <span class="token function">walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">is</span> Flea<span class="token punctuation">)</span>
    <span class="token function">crawl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span>
    <span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">interface</span> SwimmingInsect<span class="token operator">:</span> Insect <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;<span class="token interpolation variable">$name</span>: swim&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> WaterWalker<span class="token operator">:</span> Insect <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token function">walkWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token string">&quot;<span class="token interpolation variable">$name</span>: walk on water&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> WaterBeetle <span class="token operator">:</span> SwimmingInsect
<span class="token keyword">class</span> WaterStrider <span class="token operator">:</span> WaterWalker
<span class="token keyword">class</span> WhirligigBeetle <span class="token operator">:</span>
  SwimmingInsect<span class="token punctuation">,</span> WaterWalker

<span class="token keyword">fun</span> Insect<span class="token punctuation">.</span><span class="token function">water</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
  <span class="token keyword">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> SwimmingInsect <span class="token operator">-&gt;</span> <span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">is</span> WaterWalker <span class="token operator">-&gt;</span> <span class="token function">walkWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;<span class="token interpolation variable">$name</span>: drown&quot;</span>
  <span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> insects <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span>
    <span class="token function">HouseFly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Flea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">WaterStrider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">WaterBeetle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">WhirligigBeetle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  insects<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">basic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[HouseFly: walk HouseFly: fly, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Flea: walk Flea: crawl, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;WaterStrider: walk WaterStrider: fly, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;WaterBeetle: walk WaterBeetle: fly, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;WhirligigBeetle: walk &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;WhirligigBeetle: fly]&quot;</span>
  insects<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">water</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[HouseFly: drown, Flea: drown, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;WaterStrider: walk on water, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;WaterBeetle: swim, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;WhirligigBeetle: swim]&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>有很少一部分的昆虫可以在水上行走,或者是在水下游泳. 同样,对于这些特殊类型的行为,没有必要为这些少数例子在基类中编写相应的功能来给予支持. 相反<code>Insect.water()</code> 包含了一个<code>when</code>表达式,来挑选出那些具有特殊行为的子类,并将其他行为假定为标准行为
选择几个单独的类型进行特殊处理是类型检查的典型用法. 注意,向一个系统中,添加新的理性并不会影响现有的代码(除非添加的新类型也需要特殊处理).
为了简化代码,<code>name</code> produces the type of the object pointed to by the <code>this</code> under question:(译者注: 后续如果有类似的英文,是因为我不知道这一句话该怎么翻译才比较地道)</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// TypeChecking/AnyName.kt</span>
<span class="token keyword">package</span> typechecking

<span class="token keyword">val</span> Any<span class="token punctuation">.</span>name
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>simpleName
</code></pre></div><p><code>name</code> 接受一个<code>Any</code>类型,并且通过使用<code>::class</code> 来获取相关联类的引用,之后生成这个类的<code>simpleName</code>
现在,考虑&quot;shape&quot;例子的一种变体:</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// TypeChecking/TypeCheck1.kt</span>
<span class="token keyword">package</span> typechecking
<span class="token keyword">import</span> atomictest<span class="token punctuation">.</span>eq

<span class="token keyword">interface</span> Shape <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String
<span class="token punctuation">}</span>

<span class="token keyword">class</span> Circle <span class="token operator">:</span> Shape <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Circle: Draw&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> Square <span class="token operator">:</span> Shape <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Square: Draw&quot;</span>
  <span class="token keyword">fun</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Square: Rotate&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">turn</span><span class="token punctuation">(</span>s<span class="token operator">:</span> Shape<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">when</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">is</span> Square <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> shapes <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token function">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Square</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  shapes<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Circle: Draw, Square: Draw]&quot;</span>
  shapes<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">turn</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[, Square: Rotate]&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>有很多种原因可以解释为什么你也许会添加<code>rotate()</code>方法到<code>Square</code>类中,而不是直接添加到<code>Shape</code>接口中:</p> <ul><li><code>Shape</code> 接口不在你的控制中,所以你不能够修改这个接口</li> <li>旋转(Rotating)<code>Square</code> 似乎是一种特殊的例子,而它不应该让你的<code>Shapre</code>接口变的复杂</li> <li>你正在尝试通过添加<code>Square</code>类来快速的解决某些问题,并且你不希望面对因<code>rotate()</code>引入<code>Shape</code>而造成的一些问题,同时,你也不想在所有子类中实现这个函数.</li></ul> <p>当然,在某些情况下,这种解决方案不会对你的代码产生负面影响,并且 Koltin 中的<code>when</code>表达式能够生成干净,直接的代码</p> <p>然而,如果你必须通过添加更多的类型来改进你的系统,那么它就会开始变得混乱:</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// TypeChecking/TypeCheck2.kt</span>
<span class="token keyword">package</span> typechecking
<span class="token keyword">import</span> atomictest<span class="token punctuation">.</span>eq

<span class="token keyword">class</span> Triangle <span class="token operator">:</span> Shape <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Triangle: Draw&quot;</span>
  <span class="token keyword">fun</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Triangle: Rotate&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">turn2</span><span class="token punctuation">(</span>s<span class="token operator">:</span> Shape<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">when</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">is</span> Square <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">is</span> Triangle <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> shapes <span class="token operator">=</span>
    <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token function">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Square</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Triangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  shapes<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Circle: Draw, Square: Draw, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Triangle: Draw]&quot;</span>
  shapes<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">turn</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[, Square: Rotate, ]&quot;</span>
  shapes<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">turn2</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[, Square: Rotate, Triangle: Rotate]&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<code>shapes.map { it.draw() }</code>中的多态调用,能够适应新的<code>Triangle</code>类而不用做出任何变化,或产生任何错误.同样,Kotlin 不允许使用<code>Triangle</code>除非这个类实现了<code>draw()</code>方法</p> <p>原始的<code>turn()</code>不会因为我们添加了<code>Triangle</code>而被破坏,但是它也不会产生我们想要的结果.<code>turn()</code>必须变成<code>turn2</code>以确保我们能够得到想要的结果.
The original <code>turn()</code> doesn’t break when we add <code>Triangle</code>, but it also doesn’t produce the result we want. <code>turn()</code> must become <code>turn2()</code> to generate the desired behavior.</p> <p>假设你的系统中开始逐渐积累越来越多像<code>turn()</code> 这样的函数. <code>Shape</code>的逻辑现在分布在了所有的函数中,而不是集中在<code>Shape</code>所在的层次体系中(译者注: hierarchy 等级制度,这里指Shape类的继承关系). 如果你想要添加更多的<code>Shape</code> 类型(更多的类去Shape),你必须查看每个包含<code>when</code>表达式,并且会将参数转换为<code>Shape</code>的子类的函数,并对他们修改,增加你新实现的类型. 如果你漏掉了其中任何一个函数,编译器就会捕获不到这个类型.(译注: 这一句我不太确定it 指代的是什么, If you miss any of these functions, the compiler won’t catch it.)</p> <p><code>turn()</code> 和 <code>turn2()</code> 展示了通常所说的 <em>type-check coding</em>, 即对你当前系统中的每一个类型进行测试.(如果你寻找某一个或某几种特殊的类型,这一般不被叫做 type-check coding )</p> <p>在传统的面向对象语言中,type-check coding通常被认为是一种antipattern,因为他需要额外的一段或多段代码,并且每当你在系统中添加或更新某一种类型时,都必须晋升的维护和更新这些代码. 另一方面,多态性会把这些更改封装到你添加或修改的类型中,然后这些更改将通过您的系统透明地传播.</p> <p>注意,这些问题只会在你升级系统的时候,添加更多的<code>Shape</code>类型才发生. 如果你在更新你的系统的时候并不会这么干,你也就不会经历这些问题.如果这是一个问题，它通常不会突然发生，但随着系统的发展，它会变得更加复杂。</p> <p>我们需要意识到,kotlin 通过使用<code>sealed</code>类,显著的减少了这些问题.该解决方案并不完美，但类型检查成为一种更合理的设计选择.</p> <h3 id="辅助函数中的类型检查"><a href="#辅助函数中的类型检查" class="header-anchor">#</a> 辅助函数中的类型检查</h3> <p><code>BeverageContainer</code>的本质是它可以容纳和运送饮料。将回收视为一种 辅助函数 似乎是有道理的：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// TypeChecking/BeverageContainer.kt</span>
<span class="token keyword">package</span> typechecking
<span class="token keyword">import</span> atomictest<span class="token punctuation">.</span>eq

<span class="token keyword">interface</span> BeverageContainer <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String
  <span class="token keyword">fun</span> <span class="token function">pour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String
<span class="token punctuation">}</span>

<span class="token keyword">class</span> Can <span class="token operator">:</span> BeverageContainer <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Pop Top&quot;</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">pour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Can: Pour&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">open</span> <span class="token keyword">class</span> Bottle <span class="token operator">:</span> BeverageContainer <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Remove Cap&quot;</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">pour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Bottle: Pour&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> GlassBottle <span class="token operator">:</span> <span class="token function">Bottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> PlasticBottle <span class="token operator">:</span> <span class="token function">Bottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">fun</span> BeverageContainer<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
  <span class="token keyword">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Can <span class="token operator">-&gt;</span> <span class="token string">&quot;Recycle Can&quot;</span>
    <span class="token keyword">is</span> GlassBottle <span class="token operator">-&gt;</span> <span class="token string">&quot;Recycle Glass&quot;</span>
    <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Landfill&quot;</span>
  <span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> refrigerator <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span>
    <span class="token function">Can</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">GlassBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">PlasticBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  refrigerator<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Pop Top, Remove Cap, Remove Cap]&quot;</span>
  refrigerator<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Recycle Can, Recycle Glass, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Landfill]&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过将<code>recycle()</code>定义为一个辅助函数,从而让它可以在单个位置捕获不同的回收行为,而不是通过将<code>recycle()</code> 作为一个成员函数,将其分布在<code>BeverageContainer</code>的层次结构(hierarchy)中.</p> <p>使用<code>when</code>对类型进行操作,简单而又直接,但是这种设计仍然存在问题.当你要添加一个新的类型时,<code>recycle()</code> 会悄悄地使用<code>else</code>子句.因此,可能会错过对<code>recycle()</code>等类型检查函数的必要更改.我们希望编译器告诉我们,我们忘记了哪种了类型检查.就像我们实现接口或继承,抽象类一样,它告诉我们忘记了重写函数一样.</p> <p>封闭类提供了显著的改进. 将<code>Shaped</code>设置为<code>sealed</code>类意味着(删除 else字句后)<code>turn()</code>中的<code>when</code>需要检查每个类型.接口不能用<code>sealed</code>修饰,所我们需要重写<code>Shape</code>类(将其变为 sealed)
<code>sealed</code> classes provide a significant improvement here. Making <code>Shape</code> a <code>sealed</code> class means that the <code>when</code> in <code>turn()</code> (after removing the <code>else</code>) requires that each type be checked. Interfaces cannot be <code>sealed</code> so we must rewrite <code>Shape</code> into a class:</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// TypeChecking/TypeCheck3.kt</span>
<span class="token keyword">package</span> typechecking3
<span class="token keyword">import</span> atomictest<span class="token punctuation">.</span>eq
<span class="token keyword">import</span> typechecking<span class="token punctuation">.</span>name

<span class="token keyword">sealed</span> <span class="token keyword">class</span> Shape <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;<span class="token interpolation variable">$name</span>: Draw&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> Circle <span class="token operator">:</span> <span class="token function">Shape</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> Square <span class="token operator">:</span> <span class="token function">Shape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Square: Rotate&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> Triangle <span class="token operator">:</span> <span class="token function">Shape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Triangle: Rotate&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">turn</span><span class="token punctuation">(</span>s<span class="token operator">:</span> Shape<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">when</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">is</span> Circle <span class="token operator">-&gt;</span> <span class="token string">&quot;&quot;</span>
  <span class="token keyword">is</span> Square <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">is</span> Triangle <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> shapes <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token function">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Square</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  shapes<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Circle: Draw, Square: Draw]&quot;</span>
  shapes<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">turn</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[, Square: Rotate]&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果我们增加了一个新的<code>Shape</code>子类,编译器会告诉我们,我们需要在<code>turn()</code>中添加一个新的类型检查路径</p> <p>现在让我们看看,当我们想要将<code>sealed</code>应用于<code>BeverageContainer</code>问题,会发生生么.在此过程中,我们创建了<code>Can</code>和<code>Bottle</code>子类型</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// TypeChecking/BeverageContainer2.kt</span>
<span class="token keyword">package</span> typechecking2
<span class="token keyword">import</span> atomictest<span class="token punctuation">.</span>eq

<span class="token keyword">sealed</span> <span class="token keyword">class</span> BeverageContainer <span class="token punctuation">{</span>
  <span class="token keyword">abstract</span> <span class="token keyword">fun</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String
  <span class="token keyword">abstract</span> <span class="token keyword">fun</span> <span class="token function">pour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String
<span class="token punctuation">}</span>

<span class="token keyword">sealed</span> <span class="token keyword">class</span> Can <span class="token operator">:</span> <span class="token function">BeverageContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Pop Top&quot;</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">pour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Can: Pour&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> SteelCan <span class="token operator">:</span> <span class="token function">Can</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> AluminumCan <span class="token operator">:</span> <span class="token function">Can</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">sealed</span> <span class="token keyword">class</span> Bottle <span class="token operator">:</span> <span class="token function">BeverageContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Remove Cap&quot;</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">pour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Bottle: Pour&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> GlassBottle <span class="token operator">:</span> <span class="token function">Bottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">sealed</span> <span class="token keyword">class</span> PlasticBottle <span class="token operator">:</span> <span class="token function">Bottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> PETBottle <span class="token operator">:</span> <span class="token function">PlasticBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> HDPEBottle <span class="token operator">:</span> <span class="token function">PlasticBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">fun</span> BeverageContainer<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
  <span class="token keyword">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Can <span class="token operator">-&gt;</span> <span class="token string">&quot;Recycle Can&quot;</span>
    <span class="token keyword">is</span> Bottle <span class="token operator">-&gt;</span> <span class="token string">&quot;Recycle Bottle&quot;</span>
  <span class="token punctuation">}</span>

<span class="token keyword">fun</span> BeverageContainer<span class="token punctuation">.</span><span class="token function">recycle2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
  <span class="token keyword">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Can <span class="token operator">-&gt;</span> <span class="token keyword">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">is</span> SteelCan <span class="token operator">-&gt;</span> <span class="token string">&quot;Recycle Steel&quot;</span>
      <span class="token keyword">is</span> AluminumCan <span class="token operator">-&gt;</span> <span class="token string">&quot;Recycle Aluminum&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">is</span> Bottle <span class="token operator">-&gt;</span> <span class="token keyword">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">is</span> GlassBottle <span class="token operator">-&gt;</span> <span class="token string">&quot;Recycle Glass&quot;</span>
      <span class="token keyword">is</span> PlasticBottle <span class="token operator">-&gt;</span> <span class="token keyword">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">is</span> PETBottle <span class="token operator">-&gt;</span> <span class="token string">&quot;Recycle PET&quot;</span>
        <span class="token keyword">is</span> HDPEBottle <span class="token operator">-&gt;</span> <span class="token string">&quot;Recycle HDPE&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> refrigerator <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span>
    <span class="token function">SteelCan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">AluminumCan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">GlassBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">PETBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">HDPEBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  refrigerator<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Pop Top, Pop Top, Remove Cap, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Remove Cap, Remove Cap]&quot;</span>
  refrigerator<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Recycle Can, Recycle Can, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Recycle Bottle, Recycle Bottle, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Recycle Bottle]&quot;</span>
  refrigerator<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">recycle2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Recycle Steel, Recycle Aluminum, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Recycle Glass, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Recycle PET, Recycle HDPE]&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>请注意，子类“Can”和“Bottle”也必须变成密封类,才能使用这种方法。</p> <p>只要类是“BeverageContainer”的直接子类，编译器就保证<code>recycle()</code>中的<code>when</code>是穷举的. 但是像<code>GlassBottle</code>和<code>AluminumCan</code>这样的子类没有被检查。为了解决这个问题，我们必须显式地包括在<code>recycle2()</code>中看到的嵌套的<code>when</code>表达式，此时编译器<em>确实</em>需要彻底的类型检查（尝试注释一个特定的<code>Can</code>或<code>Bottle</code>类型来验证这一点）。</p> <p>为了为了创建一个健壮的类型检查解决方案,你必须在类的层次结构中的每个中间级别(一个sealed 类的子类,不是孙类)严格使用<code>sealed</code>,同时确保每个子类的每个级别都有相应的嵌套<code>when</code>在这种情况下,如果添加<code>can</code> 或<code>Bottle</code>的新的子类型,编译器将确保<code>recycle2()</code>测试每个子类型</p> <p>虽然没有 多态 那么干净，但这是对以前的面向对象语言的重大改进，并允许您选择是编写多态成员函数还是编写辅助函数。请注意，只有当您具有多个继承级别时，才会出现此问题。</p> <p>为了进行比较,让我们重写<code>BeverageContainer2.kt</code>通过将<code>recycle()</code>引入<code>BeverageContainer</code>，该容器也可以是一个<code>interface</code>：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// TypeChecking/BeverageContainer3.kt</span>
<span class="token keyword">package</span> typechecking3
<span class="token keyword">import</span> atomictest<span class="token punctuation">.</span>eq
<span class="token keyword">import</span> typechecking<span class="token punctuation">.</span>name

<span class="token keyword">interface</span> BeverageContainer <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String
  <span class="token keyword">fun</span> <span class="token function">pour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;<span class="token interpolation variable">$name</span>: Pour&quot;</span>
  <span class="token keyword">fun</span> <span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> Can <span class="token operator">:</span> BeverageContainer <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Pop Top&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> SteelCan <span class="token operator">:</span> <span class="token function">Can</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Recycle Steel&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> AluminumCan <span class="token operator">:</span> <span class="token function">Can</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Recycle Aluminum&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> Bottle <span class="token operator">:</span> BeverageContainer <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Remove Cap&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> GlassBottle <span class="token operator">:</span> <span class="token function">Bottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Recycle Glass&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> PlasticBottle <span class="token operator">:</span> <span class="token function">Bottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> PETBottle <span class="token operator">:</span> <span class="token function">PlasticBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Recycle PET&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> HDPEBottle <span class="token operator">:</span> <span class="token function">PlasticBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Recycle HDPE&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> refrigerator <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span>
    <span class="token function">SteelCan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">AluminumCan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">GlassBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">PETBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">HDPEBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  refrigerator<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Pop Top, Pop Top, Remove Cap, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Remove Cap, Remove Cap]&quot;</span>
  refrigerator<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> eq
    <span class="token string">&quot;[Recycle Steel, Recycle Aluminum, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Recycle Glass, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;Recycle PET, Recycle HDPE]&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以通过生成<code>Can</code> 和<code>Bottle</code>抽象类,我们强化自它们的子类型重写<code>recycle()</code>,就像编译器强制在<code>BeverageContainer2.kt</code>中的<code>recycle2()</code>内检查每一个类型一样</p> <p>现在<code>recycle()</code>的行为分布在不同的子类之间，这可能是一个设计决策。如果您决定回收行为经常发生变化，并且希望将其全部放在一个地方，那么使用 <code>BeverageContainer2.kt</code> 中的辅助类型检测函数<code>recycle2()</code>可能是一个更好的选择，以满足您的需求，科特林的特点使这一点合理。</p> <p><em><strong>Exercises and solutions can be found at www.AtomicKotlin.com.</strong></em></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Angus-Liu/Atomic-Kotlin-zh/edit/main/docs/se05-ch14.md" target="_blank" rel="noopener noreferrer">翻译有错？帮助改进:)</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Atomic-Kotlin-zh/se05-ch13.html" class="prev">
        Sealed Classes
      </a></span> <span class="next"><a href="/Atomic-Kotlin-zh/se05-ch15.html">
        Nested Classes
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Atomic-Kotlin-zh/assets/js/app.6fe342f5.js" defer></script><script src="/Atomic-Kotlin-zh/assets/js/2.3bbd8e5a.js" defer></script><script src="/Atomic-Kotlin-zh/assets/js/184.51f2111c.js" defer></script>
  </body>
</html>
